#-*â€” coding:UTF-8 -*-
#/usr/bin/env python
"""
module descript
"""
import json
import time

from lib.utils import download, ensure_effective


ACCESS_TOKEN = None
ACCESS_TOKEN_EFFECTIVE_TIME = 0
APP_ID = "wx4202800187673dae"
APP_SECRET = "21149a9db81a49fca7f8a65d9a7faef6"
ACCESS_TOKEN_URL = "https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=%s&secret=%s"
TOKEN = "ssjssh"
DATA = None


def get_access_token():
    global DATA
    global ACCESS_TOKEN
    global ACCESS_TOKEN_EFFECTIVE_TIME
    url = get_access_token_url(APP_ID, APP_SECRET)
    data = download(url)
    clean_data = json.loads(data)
    ACCESS_TOKEN = clean_data['access_token']
    ACCESS_TOKEN_EFFECTIVE_TIME = clean_data['expires_in']+time.time()
    DATA = data


def get_access_token_url(app_id, app_secret):
    url = ACCESS_TOKEN_URL % (app_id, app_secret)
    return url


def ensure_access_token_effective(f):
    global ACCESS_TOKEN_EFFECTIVE_TIME
    return ensure_effective(f, get_access_token, ACCESS_TOKEN_EFFECTIVE_TIME)

