#-*â€” coding:UTF-8 -*-
#/usr/bin/env python
"""
module descript
"""
import json
import time

from django.conf import settings
from lib.utils import download, ensure_effective


ACCESS_TOKEN = None
ACCESS_TOKEN_EFFECTIVE_TIME = 0


def get_access_token():
    global ACCESS_TOKEN_EFFECTIVE_TIME
    global ACCESS_TOKEN
    url = get_access_token_url(settings.APP_ACCESS['app_id'],
                               settings.APP_ACCESS['app_secret'])
    data = download(url)
    clean_data = json.loads(data)
    ACCESS_TOKEN = clean_data['access_token']
    ACCESS_TOKEN_EFFECTIVE_TIME = clean_data['expires_in']+time.time()


def get_access_token_url(app_id, app_secret):
    url = settings.COMPANY_URL['token']['ACCESS_TOKEN_URL'] % (app_id, app_secret)
    return url


def ensure_access_token_effective(f):
    global ACCESS_TOKEN_EFFECTIVE_TIME
    return ensure_effective(f, get_access_token, ACCESS_TOKEN_EFFECTIVE_TIME)

