#-*â€” coding:UTF-8 -*-
#/usr/bin/env python
import json
import urllib
from django.conf import settings
from lib.utils import download, post, ensure_effective
import token

"""
module descript
"""
TICKET = None



@token.ensure_access_token_effective
def get_ticket():
    global TICKET
    global TICKET_EFFECTIVE_TIME
    url = settings.COMPANY_URL['qrcode']['GET_QR_CODE_TICKET_URL'] + "?" + \
          urllib.urlencode({"access_token": token.ACCESS_TOKEN})
    resp_data = post(url, json.dumps(settings.COMPANY_URL['qrcode']['GET_QR_CODE_TICKET_JSON']))
    ticket_json = json.loads(resp_data)
    TICKET = ticket_json["ticket"]
    return TICKET


def ensure_ticket_effective(f):
    if(TICKET == None):
        get_ticket()
    return f


@ensure_ticket_effective
def get_qrcode():
    url = settings.COMPANY_URL['qrcode']['GET_QR_CODE_URL'] + "?" + urllib.urlencode({"ticket": TICKET})
    qr_data = download(url)
    return qr_data


