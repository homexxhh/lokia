#-*â€” coding:UTF-8 -*-
#/usr/bin/env python
import json
import urllib
from django.views.decorators import csrf
from django.conf import settings
from lib.utils import parse_request, post, json_loads
from lib.response import BaseResponse
import token

"""
module descript
"""


@csrf.csrf_exempt
@parse_request
def about(msg):
    resp = BaseResponse(msg, "about.xml")
    return resp.get_response()


@csrf.csrf_exempt
@parse_request
def contact(msg):
    resp = BaseResponse(msg, "contact.xml")
    return resp.get_response()


@csrf.csrf_exempt
@parse_request
def order(msg):
    post_data = data = urllib.urlencode({"openid": msg['FromUserName']})
    is_binding = post(settings.COMPANY_URL['IS_BINDING'], post_data)
    is_binding = json_loads(is_binding)
    if(is_binding['success']):
        order_json = json_loads(post(settings.COMPANY_URL['ORDER_LIST'],
                                     post_data))
        context = {"order": order_json}
        return BaseResponse(msg).get_response(context)
    else:
        context = {"openid": msg['FromUserName']}
        return BaseResponse(msg, "login_notify.xml").get_response(context)
