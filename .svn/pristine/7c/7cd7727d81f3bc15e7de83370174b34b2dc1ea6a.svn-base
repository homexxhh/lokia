#-*— coding:UTF-8 -*-
#/usr/bin/env python
"""
module descript
"""
import hashlib
from django.http import HttpResponse
from django.views.generic import TemplateView
from django.views.decorators import csrf
from lib.utils import parse_request, parase_msg_xml
from lib.response import TextResponse, BaseResponse
import menu
import token


class IndexView(TemplateView):
    template_name = "test.xml"

    def get(self, request, *args, **kwargs):
        command = request.GET.get('com', None)
        if command == "menu":
            menu.create_menu()
            return HttpResponse("succeed")
        else:
            return super(IndexView, self).get(request, *args, **kwargs)

    def get_context_data(self, **kwargs):
        context = {'ToUserName': '我去', 'FromUserName': '尼玛', 'CreateTime': '草鸡空碟',
                   'Content': '尼，肯跌啊'}
        return context


@csrf.csrf_exempt
def check_signature(request):
    signature = request.GET.get("signature", None)
    timestamp = request.GET.get("timestamp", None)
    nonce = request.GET.get("nonce", None)
    echo_str = request.GET.get("echostr", None)
    tok = token.TOKEN
    tmp_list = [tok, timestamp, nonce]
    tmp_list.sort()
    tmp_str = "%s%s%s" % tuple(tmp_list)
    tmp_str = hashlib.sha1(tmp_str).hexdigest()
    if tmp_str == signature:
        response = HttpResponse(echo_str, content_type="text/plain")
        return response
    else:
        return HttpResponse(None, content_type='text/plain')


@csrf.csrf_exempt
@token.ensure_access_token_effective
@parse_request
def response_msg(msg):
    resp = TextResponse(msg)
    context = {'Content': '我靠'}
    return resp.get_response(context)


@csrf.csrf_exempt
@token.ensure_access_token_effective
@parse_request
def about(msg):
    resp = BaseResponse(msg)
    resp.template_name = '/about.xml'
    resp = resp.get_response()
    return resp


@csrf.csrf_exempt
@token.ensure_access_token_effective
@parse_request
def contact(msg):
    resp = BaseResponse(msg)
    resp.template_name = '/contact.xml'
    resp = resp.get_response()
    return resp



